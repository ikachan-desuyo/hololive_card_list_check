<!DOCTYPE html>
<html lang="ja">
<!-- Version: 4.1.0-COLLECTION-BINDER - Visual collection binder interface -->
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>ホロライブカード コレクションバインダー</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      transition: background 0.3s, color 0.3s;
    }

    .dark { 
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
      color: #eee; 
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .dark .header {
      background: rgba(44, 62, 80, 0.95);
    }

    .header h1 {
      margin: 0;
      text-align: center;
      background: linear-gradient(45deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 2.5em;
      font-weight: bold;
    }

    .controls {
      display: flex;
      gap: 15px;
      align-items: center;
      justify-content: center;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .controls input, .controls select, .controls button {
      padding: 10px 15px;
      border: 2px solid #667eea;
      border-radius: 25px;
      background: white;
      color: #333;
      outline: none;
      transition: all 0.3s;
    }

    .dark .controls input, .dark .controls select, .dark .controls button {
      background: #34495e;
      color: #eee;
      border-color: #5dade2;
    }

    .controls button {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }

    .controls button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    .main-content {
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .series-section {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .dark .series-section {
      background: rgba(44, 62, 80, 0.9);
      border-color: rgba(93, 173, 226, 0.2);
    }

    .series-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #667eea;
    }

    .series-title {
      font-size: 1.5em;
      font-weight: bold;
      color: #667eea;
    }

    .dark .series-title {
      color: #5dade2;
    }

    .series-stats {
      font-size: 0.9em;
      color: #666;
    }

    .dark .series-stats {
      color: #bdc3c7;
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 15px;
      padding: 10px 0;
    }

    .card-slot {
      aspect-ratio: 2.5/3.5;
      border: 3px dashed #ddd;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      transition: all 0.3s;
      cursor: pointer;
      background: linear-gradient(145deg, #f0f2f5, #e6e9ed);
      box-shadow: inset 5px 5px 10px #d1d5db, inset -5px -5px 10px #ffffff;
    }

    .card-slot.owned {
      border-color: #27ae60;
      background: linear-gradient(145deg, #d5f4e6, #27ae60);
      color: white;
      box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
    }

    .card-slot.multiple {
      border-color: #f39c12;
      background: linear-gradient(145deg, #ffeaa7, #f39c12);
      color: white;
      box-shadow: 0 5px 15px rgba(243, 156, 18, 0.3);
    }

    .card-slot.rare {
      border-color: #e74c3c;
      background: linear-gradient(145deg, #ff7675, #e74c3c);
      animation: rareGlow 2s ease-in-out infinite alternate;
    }

    @keyframes rareGlow {
      from { box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3); }
      to { box-shadow: 0 8px 25px rgba(231, 76, 60, 0.6); }
    }

    .card-slot:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }

    .card-id {
      font-size: 0.8em;
      font-weight: bold;
      text-align: center;
      margin-bottom: 5px;
      word-break: break-all;
    }

    .card-count {
      font-size: 1.2em;
      font-weight: bold;
      background: rgba(0,0,0,0.1);
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: auto;
    }

    .card-slot.owned .card-count {
      background: rgba(255,255,255,0.2);
    }

    .rarity-indicator {
      position: absolute;
      top: 5px;
      right: 5px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      font-size: 0.7em;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
    }

    .rarity-OSR, .rarity-OUR { background: #9b59b6; }
    .rarity-UR { background: #e74c3c; }
    .rarity-SR { background: #f39c12; }
    .rarity-RR { background: #3498db; }
    .rarity-R { background: #27ae60; }
    .rarity-U { background: #95a5a6; }
    .rarity-C { background: #7f8c8d; }

    .stats-bar {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 15px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-around;
      align-items: center;
      text-align: center;
    }

    .dark .stats-bar {
      background: rgba(44, 62, 80, 0.9);
    }

    .stat-item {
      flex: 1;
    }

    .stat-value {
      font-size: 2em;
      font-weight: bold;
      color: #667eea;
    }

    .dark .stat-value {
      color: #5dade2;
    }

    .stat-label {
      font-size: 0.9em;
      color: #666;
    }

    .dark .stat-label {
      color: #bdc3c7;
    }

    .nav-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      justify-content: center;
    }

    .nav-buttons button {
      padding: 10px 20px;
      border: none;
      border-radius: 25px;
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      text-decoration: none;
      display: inline-block;
    }

    .nav-buttons button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    @media (max-width: 768px) {
      .cards-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 10px;
      }
      
      .card-slot {
        aspect-ratio: 2.5/3.5;
      }
      
      .card-id {
        font-size: 0.7em;
      }
      
      .controls {
        flex-direction: column;
        gap: 10px;
      }
      
      .stats-bar {
        flex-direction: column;
        gap: 10px;
      }
    }
  </style>
</head>

<body>
  <div class="header">
    <h1>🎴 コレクションバインダー</h1>
    <div class="nav-buttons">
      <button onclick="location.href='index.html'">🏠 ホーム</button>
      <button onclick="location.href='card_list.html'">📋 一覧表示</button>
      <button onclick="location.href='holoca_skill_page.html'">🔍 詳細検索</button>
      <button onclick="location.href='deck_builder.html'">⚔️ デッキ作成</button>
    </div>
    
    <div class="controls">
      <input type="text" id="searchInput" placeholder="🔍 カード検索..." oninput="filterCards()">
      <select id="seriesFilter" onchange="filterCards()">
        <option value="">全シリーズ</option>
        <option value="hBP04">ブースターパック第4弾</option>
        <option value="hBP03">ブースターパック第3弾</option>
        <option value="hBP02">ブースターパック第2弾</option>
        <option value="hBP01">ブースターパック第1弾</option>
        <option value="hSD">スターターデッキ</option>
      </select>
      <select id="rarityFilter" onchange="filterCards()">
        <option value="">全レアリティ</option>
        <option value="OSR,OUR">超レア (OSR/OUR)</option>
        <option value="UR">ウルトラレア (UR)</option>
        <option value="SR">スーパーレア (SR)</option>
        <option value="RR">ダブルレア (RR)</option>
        <option value="R">レア (R)</option>
        <option value="U">アンコモン (U)</option>
        <option value="C">コモン (C)</option>
      </select>
      <select id="ownedFilter" onchange="filterCards()">
        <option value="">全て</option>
        <option value="owned">所持済み</option>
        <option value="unowned">未所持</option>
        <option value="multiple">複数所持</option>
      </select>
      <button onclick="toggleDarkMode()">🌗 ダークモード</button>
    </div>
  </div>

  <div class="main-content">
    <div class="stats-bar">
      <div class="stat-item">
        <div class="stat-value" id="totalCards">0</div>
        <div class="stat-label">総カード数</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="ownedCards">0</div>
        <div class="stat-label">所持カード</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="completionRate">0%</div>
        <div class="stat-label">収集率</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="totalOwned">0</div>
        <div class="stat-label">総所持枚数</div>
      </div>
    </div>

    <div id="cardContainer">
      <!-- カードが動的に生成される -->
    </div>
  </div>

  <script>
    let cards = [];
    let filteredCards = [];

    // カードデータを読み込み
    async function loadCards() {
      try {
        const response = await fetch('json_file/card_data.json');
        const data = await response.json();
        cards = data.map(card => {
          const owned = parseInt(localStorage.getItem("count_" + card.id) || "0");
          return { ...card, owned };
        });
        filteredCards = [...cards];
        renderStats();
        renderCards();
      } catch (error) {
        console.error('カードデータの読み込みに失敗しました:', error);
      }
    }

    // 統計情報を表示
    function renderStats() {
      const totalCards = cards.length;
      const ownedCards = cards.filter(card => card.owned > 0).length;
      const completionRate = totalCards > 0 ? Math.round((ownedCards / totalCards) * 100) : 0;
      const totalOwned = cards.reduce((sum, card) => sum + card.owned, 0);

      document.getElementById('totalCards').textContent = totalCards;
      document.getElementById('ownedCards').textContent = ownedCards;
      document.getElementById('completionRate').textContent = completionRate + '%';
      document.getElementById('totalOwned').textContent = totalOwned;
    }

    // カードをシリーズ別にグループ化
    function groupCardsBySeries(cards) {
      const groups = {};
      cards.forEach(card => {
        let series = 'その他';
        if (card.id.startsWith('hBP04')) series = 'ブースターパック第4弾';
        else if (card.id.startsWith('hBP03')) series = 'ブースターパック第3弾';
        else if (card.id.startsWith('hBP02')) series = 'ブースターパック第2弾';
        else if (card.id.startsWith('hBP01')) series = 'ブースターパック第1弾';
        else if (card.id.startsWith('hSD')) series = 'スターターデッキ';
        else if (card.id.startsWith('hPR')) series = 'プロモカード';
        else if (card.id.startsWith('hY')) series = '記念カード';

        if (!groups[series]) groups[series] = [];
        groups[series].push(card);
      });
      return groups;
    }

    // カードを表示
    function renderCards() {
      const container = document.getElementById('cardContainer');
      container.innerHTML = '';

      const groups = groupCardsBySeries(filteredCards);
      
      Object.entries(groups).forEach(([series, seriesCards]) => {
        const section = document.createElement('div');
        section.className = 'series-section';

        const ownedInSeries = seriesCards.filter(card => card.owned > 0).length;
        const totalInSeries = seriesCards.length;
        const seriesRate = totalInSeries > 0 ? Math.round((ownedInSeries / totalInSeries) * 100) : 0;

        section.innerHTML = `
          <div class="series-header">
            <div class="series-title">${series}</div>
            <div class="series-stats">
              ${ownedInSeries}/${totalInSeries} (${seriesRate}%)
            </div>
          </div>
          <div class="cards-grid">
            ${seriesCards.map(card => createCardElement(card)).join('')}
          </div>
        `;

        container.appendChild(section);
      });
    }

    // カード要素を作成
    function createCardElement(card) {
      const rarity = extractRarity(card.id);
      let className = 'card-slot';
      
      if (card.owned > 0) {
        className += ' owned';
        if (card.owned > 1) className += ' multiple';
        if (['OSR', 'OUR', 'UR', 'SR'].includes(rarity)) className += ' rare';
      }

      return `
        <div class="${className}" onclick="toggleCard('${card.id}')">
          <div class="rarity-indicator rarity-${rarity}">${rarity}</div>
          <div class="card-id">${card.id}</div>
          <div class="card-count">${card.owned}</div>
        </div>
      `;
    }

    // レアリティを抽出
    function extractRarity(cardId) {
      const parts = cardId.split('_');
      if (parts.length > 1) {
        const rarity = parts[parts.length - 1];
        if (['OSR', 'OUR', 'UR', 'SR', 'RR', 'R', 'U', 'C', 'OC'].includes(rarity)) {
          return rarity;
        }
      }
      return 'C';
    }

    // カードの所持数を変更
    function toggleCard(cardId) {
      const currentCount = parseInt(localStorage.getItem("count_" + cardId) || "0");
      const newCount = (currentCount + 1) % 5; // 0-4でサイクル
      
      localStorage.setItem("count_" + cardId, newCount);
      
      const card = cards.find(c => c.id === cardId);
      if (card) card.owned = newCount;
      
      renderStats();
      renderCards();
    }

    // フィルター機能
    function filterCards() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const seriesFilter = document.getElementById('seriesFilter').value;
      const rarityFilter = document.getElementById('rarityFilter').value;
      const ownedFilter = document.getElementById('ownedFilter').value;

      filteredCards = cards.filter(card => {
        // 検索フィルター
        if (searchTerm && !card.id.toLowerCase().includes(searchTerm) && 
            !card.name?.toLowerCase().includes(searchTerm)) {
          return false;
        }

        // シリーズフィルター
        if (seriesFilter && !card.id.startsWith(seriesFilter)) {
          return false;
        }

        // レアリティフィルター
        if (rarityFilter) {
          const cardRarity = extractRarity(card.id);
          const rarities = rarityFilter.split(',');
          if (!rarities.includes(cardRarity)) {
            return false;
          }
        }

        // 所持状況フィルター
        if (ownedFilter === 'owned' && card.owned === 0) return false;
        if (ownedFilter === 'unowned' && card.owned > 0) return false;
        if (ownedFilter === 'multiple' && card.owned <= 1) return false;

        return true;
      });

      renderCards();
    }

    // ダークモード切り替え
    function toggleDarkMode() {
      document.body.classList.toggle('dark');
      localStorage.setItem('darkMode', document.body.classList.contains('dark'));
    }

    // 初期化
    window.addEventListener('DOMContentLoaded', () => {
      // ダークモードの復元
      if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark');
      }
      
      loadCards();
    });
  </script>
</body>
</html>

# ãƒãƒˆãƒ«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ å®Ÿè£…ç¢ºèªãƒ¬ãƒãƒ¼ãƒˆ

## æ¦‚è¦

ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã¯ã€ãƒ›ãƒ­ãƒ©ã‚¤ãƒ–TCGãƒãƒˆãƒ«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ç¾åœ¨ã®å®Ÿè£…ãŒã€æ­£è¦ã®çŠ¶æ…‹ç®¡ç†æ‰‹é †ã«å¾“ã£ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ãŸçµæœã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚

## ç¢ºèªå¯¾è±¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### 1. HololiveStateManager âœ…
- **çŠ¶æ…‹**: æ­£å¸¸å®Ÿè£…æ¸ˆã¿
- **è©³ç´°**: 
  - ä¸­å¤®çŠ¶æ…‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ãŒé©åˆ‡ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
  - ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªçŠ¶æ…‹æ›´æ–°ã‚’æä¾›
  - çŠ¶æ…‹é·ç§»ãƒ•ãƒ©ã‚°ã«ã‚ˆã‚‹ç«¶åˆçŠ¶æ…‹ã®é˜²æ­¢æ©Ÿèƒ½ã‚ã‚Š
  - ãƒ—ãƒ­ã‚­ã‚·ã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆãŒé©åˆ‡

### 2. HololiveBattleEngine âœ…
- **çŠ¶æ…‹**: æ­£å¸¸å®Ÿè£…æ¸ˆã¿
- **è©³ç´°**:
  - State Managerã¨ã®çµ±åˆãŒé©åˆ‡
  - ãƒ—ãƒ­ã‚­ã‚·ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚‹æ—¢å­˜ã‚³ãƒ¼ãƒ‰äº’æ›æ€§ã‚’ç¶­æŒ
  - createGameStateProxy()ã¨createPlayersProxy()ãŒæ­£å¸¸å‹•ä½œ

### 3. TurnManager ğŸ”§
- **çŠ¶æ…‹**: ä¿®æ­£å®Œäº†
- **ä¿®æ­£å†…å®¹**:
  ```javascript
  // ä¿®æ­£å‰ï¼ˆç›´æ¥æ›´æ–°ï¼‰
  this.gameState.currentPlayer = nextPlayer;
  this.gameState.currentPhase = 0;
  this.gameState.turnCount++;
  
  // ä¿®æ­£å¾Œï¼ˆState ManagerçµŒç”±ï¼‰
  this.engine.stateManager.updateState('PLAYER_CHANGE', { player: nextPlayer });
  this.engine.stateManager.updateState('PHASE_CHANGE', { phase: 0 });
  this.engine.stateManager.updateState('TURN_COUNT_CHANGE', { count: this.gameState.turnCount + 1 });
  ```
- **å½±éŸ¿**: ã‚¿ãƒ¼ãƒ³ç®¡ç†ã®çŠ¶æ…‹æ›´æ–°ãŒä¸€è²«æ€§ã‚’ä¿ã¤ã‚ˆã†ã«æ”¹å–„

### 4. GameSetupManager ğŸ”§
- **çŠ¶æ…‹**: ä¿®æ­£å®Œäº†
- **ä¿®æ­£å†…å®¹**:
  ```javascript
  // ä¿®æ­£å‰ï¼ˆç›´æ¥æ›´æ–°ï¼‰
  this.gameState.gameStarted = true;
  this.gameState.currentPlayer = 1;
  this.gameState.firstPlayer = playerId;
  
  // ä¿®æ­£å¾Œï¼ˆState ManagerçµŒç”±ï¼‰
  this.engine.stateManager.updateState('GAME_START', {});
  this.engine.stateManager.updateState('PLAYER_CHANGE', { player: 1 });
  this.engine.stateManager.updateState('SET_FIRST_PLAYER', { player: playerId });
  ```
- **å½±éŸ¿**: ã‚²ãƒ¼ãƒ é–‹å§‹ãƒ»ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å‡¦ç†ã®å®‰å…¨æ€§å‘ä¸Š

### 5. PhaseController ğŸ”§
- **çŠ¶æ…‹**: ä¿®æ­£å®Œäº†
- **ä¿®æ­£å†…å®¹**:
  ```javascript
  // ä¿®æ­£å‰ï¼ˆç›´æ¥æ›´æ–°ï¼‰
  this.battleEngine.players[playerId].usedLimitedThisTurn = false;
  
  // ä¿®æ­£å¾Œï¼ˆState ManagerçµŒç”±ï¼‰
  this.battleEngine.stateManager.updateState('UPDATE_PLAYER_GAME_STATE', {
    player: playerId,
    property: 'usedLimitedThisTurn',
    value: false
  });
  ```
- **å½±éŸ¿**: ãƒ•ã‚§ãƒ¼ã‚ºå‡¦ç†ã§ã®çŠ¶æ…‹æ›´æ–°ã®çµ±ä¸€æ€§ç¢ºä¿

### 6. HandManager âœ…
- **çŠ¶æ…‹**: æ­£å¸¸å®Ÿè£…æ¸ˆã¿
- **è©³ç´°**:
  - æ‰‹æœ­æ›´æ–°å‡¦ç†ã§State Managerã‚’é©åˆ‡ã«ä½¿ç”¨
  - ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†ã§ã‚‚æ­£è¦æ‰‹é †ã«å¾“ã£ã¦ã„ã‚‹
  - ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ã‚¤å‡¦ç†ãŒå®‰å…¨ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

### 7. PlacementController âœ…
- **çŠ¶æ…‹**: æ­£å¸¸å®Ÿè£…æ¸ˆã¿
- **è©³ç´°**:
  - ã‚«ãƒ¼ãƒ‰é…ç½®åˆ¶å¾¡ã§State Managerã®checkDropValidity()ã‚’ä½¿ç”¨
  - é…ç½®ãƒ«ãƒ¼ãƒ«ã®æ¤œè¨¼ãŒé©åˆ‡ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

### 8. CardInteractionManager âœ…
- **çŠ¶æ…‹**: æ­£å¸¸å®Ÿè£…æ¸ˆã¿
- **è©³ç´°**:
  - ã‚«ãƒ¼ãƒ‰è©³ç´°è¡¨ç¤ºå‡¦ç†ãŒé©åˆ‡
  - State Managerã¨ã®é€£æºãŒæ­£å¸¸

## State Managerä½¿ç”¨çŠ¶æ³åˆ†æ

### âœ… é©åˆ‡ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

1. **UPDATE_PLAYER_CARDS** - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ã®æ›´æ–°
2. **PLACE_CARD** - ã‚«ãƒ¼ãƒ‰é…ç½®å‡¦ç†
3. **SWAP_CARDS** - ã‚«ãƒ¼ãƒ‰ä½ç½®äº¤æ›
4. **UPDATE_CARD_STATE** - ã‚«ãƒ¼ãƒ‰çŠ¶æ…‹æ›´æ–°
5. **PHASE_CHANGE** - ãƒ•ã‚§ãƒ¼ã‚ºå¤‰æ›´
6. **PLAYER_CHANGE** - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å¤‰æ›´
7. **GAME_START** / **GAME_END** - ã‚²ãƒ¼ãƒ çŠ¶æ…‹å¤‰æ›´
8. **MULLIGAN_COMPLETE** - ãƒãƒªã‚¬ãƒ³å‡¦ç†
9. **RESET_TURN_FLAGS** - ã‚¿ãƒ¼ãƒ³åˆ¶é™ãƒ•ãƒ©ã‚°ãƒªã‚»ãƒƒãƒˆ

### ğŸ”§ ä¿®æ­£æ¸ˆã¿ã®å•é¡Œãƒ‘ã‚¿ãƒ¼ãƒ³

1. **ç›´æ¥çš„ãªgameStateæ›´æ–°** 
   - ä¿®æ­£å‰: `this.gameState.currentPlayer = value`
   - ä¿®æ­£å¾Œ: `this.stateManager.updateState('PLAYER_CHANGE', {player: value})`

2. **ç›´æ¥çš„ãªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹æ›´æ–°**
   - ä¿®æ­£å‰: `this.players[id].property = value`
   - ä¿®æ­£å¾Œ: `this.stateManager.updateState('UPDATE_PLAYER_GAME_STATE', {...})`

3. **é…åˆ—è¦ç´ ã®ç›´æ¥æ“ä½œ**
   - ä¿®æ­£å‰: `this.players[id].hand.push(card)`
   - ä¿®æ­£å¾Œ: `this.stateManager.updateState('UPDATE_PLAYER_CARDS', {...})`

## ãƒ—ãƒ­ã‚­ã‚·ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œç¢ºèª

### èª­ã¿å–ã‚Šæ“ä½œ âœ…
```javascript
// ã“ã‚Œã‚‰ã¯é©åˆ‡ã«ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã§å‹•ä½œ
const currentPlayer = battleEngine.gameState.currentPlayer;
const playerCard = battleEngine.players[1].center;
const handCards = battleEngine.players[1].hand;
```

### æ›¸ãè¾¼ã¿æ“ä½œ âœ…
```javascript
// ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã§ã‚‚è‡ªå‹•çš„ã«State ManagerãŒå‘¼ã°ã‚Œã‚‹
battleEngine.gameState.currentPlayer = 2; // â†’ å†…éƒ¨çš„ã«updateState()å®Ÿè¡Œ
battleEngine.players[1].center = newCard; // â†’ å†…éƒ¨çš„ã«updateState()å®Ÿè¡Œ
```

## ãƒ‡ãƒ¼ã‚¿åŒæœŸã®ç¢ºèª

### State Manager â†” ProxyåŒæœŸ âœ…
- State Manageræ›´æ–°æ™‚ã«ãƒ—ãƒ­ã‚­ã‚·ãŒè‡ªå‹•çš„ã«æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’åæ˜ 
- ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã®æ›´æ–°ãŒState Managerã«é©åˆ‡ã«ä¼æ’­
- å¾ªç’°å‚ç…§ã‚„ç„¡é™ãƒ«ãƒ¼ãƒ—ã¯ç™ºç”Ÿã—ãªã„

### Battle Engine â†” UIåŒæœŸ âœ…
- çŠ¶æ…‹æ›´æ–°å¾Œã®UIæ›´æ–°ãŒé©åˆ‡ã«å‹•ä½œ
- ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã®æ›´æ–°ãŒæ­£ã—ãåæ˜ ã•ã‚Œã‚‹
- ãƒ•ã‚§ãƒ¼ã‚ºè¡¨ç¤ºã‚„ã‚¿ãƒ¼ãƒ³æƒ…å ±ã®åŒæœŸãŒæ­£å¸¸

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç¢ºèª

### çŠ¶æ…‹æ›´æ–°ã‚¨ãƒ©ãƒ¼ âœ…
```javascript
const result = battleEngine.stateManager.updateState('ACTION_TYPE', payload);
if (!result.success) {
  console.error('çŠ¶æ…‹æ›´æ–°ã‚¨ãƒ©ãƒ¼:', result.reason);
}
```

### çŠ¶æ…‹é·ç§»ä¸­ã®ç«¶åˆé˜²æ­¢ âœ…
- `transitionInProgress`ãƒ•ãƒ©ã‚°ã«ã‚ˆã‚‹ç«¶åˆçŠ¶æ…‹ã®é©åˆ‡ãªåˆ¶å¾¡
- `UPDATE_PLAYER_CARDS`ã¯çŠ¶æ…‹é·ç§»ä¸­ã§ã‚‚å®‰å…¨ã«å®Ÿè¡Œå¯èƒ½

### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ âœ…
- çŠ¶æ…‹ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ãŒé©åˆ‡ã«å®Ÿè£…
- ä¸æ­£ãªçŠ¶æ…‹æ›´æ–°ã®é˜²æ­¢æ©Ÿèƒ½ãŒå‹•ä½œ

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¢ºèª

### çŠ¶æ…‹å±¥æ­´ç®¡ç† âœ…
- å±¥æ­´ã‚µã‚¤ã‚ºåˆ¶é™ï¼ˆ50ä»¶ï¼‰ãŒé©åˆ‡
- ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã®å–å¾—ãŒæ­£å¸¸å‹•ä½œ

### ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ âœ…
- ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã®å›é¿ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- ãƒªã‚¹ãƒŠãƒ¼ã®è¿½åŠ ãƒ»å‰Šé™¤ãŒæ­£å¸¸å‹•ä½œ

## æ®‹å­˜èª²é¡Œã¨æ¨å¥¨äº‹é …

### âœ… è§£æ±ºæ¸ˆã¿èª²é¡Œ
1. ~~TurnManagerã§ã®ç›´æ¥çŠ¶æ…‹æ›´æ–°~~ â†’ ä¿®æ­£å®Œäº†
2. ~~GameSetupManagerã§ã®ç›´æ¥çŠ¶æ…‹æ›´æ–°~~ â†’ ä¿®æ­£å®Œäº†
3. ~~PhaseControllerã§ã®ç›´æ¥çŠ¶æ…‹æ›´æ–°~~ â†’ ä¿®æ­£å®Œäº†

### ğŸ“‹ æ¨å¥¨æ”¹å–„ç‚¹

1. **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š**
   - State Managerå˜ä½“ãƒ†ã‚¹ãƒˆã®è¿½åŠ 
   - ãƒ—ãƒ­ã‚­ã‚·ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ†ã‚¹ãƒˆè¿½åŠ 
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆè¿½åŠ 

2. **å‹å®‰å…¨æ€§å‘ä¸Š**
   - TypeScriptå°å…¥æ¤œè¨
   - ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—ã®å®šæ•°åŒ–

3. **ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½æ‹¡å¼µ**
   - çŠ¶æ…‹å¤‰æ›´ã®è©³ç´°ãƒ­ã‚°æ©Ÿèƒ½
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çŠ¶æ…‹ç›£è¦–æ©Ÿèƒ½

## ã¾ã¨ã‚

### ğŸ‰ å®Ÿè£…å“è³ªè©•ä¾¡: å„ªç§€

1. **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: State Manager + Proxy ã‚·ã‚¹ãƒ†ãƒ ãŒé©åˆ‡ã«è¨­è¨ˆãƒ»å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
2. **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§**: çŠ¶æ…‹ç®¡ç†ã®ä¸€è²«æ€§ãŒç¢ºä¿ã•ã‚Œã¦ã„ã‚‹
3. **äº’æ›æ€§**: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨ã®äº’æ›æ€§ã‚’ä¿ã¡ãªãŒã‚‰æ–°ã‚·ã‚¹ãƒ†ãƒ ã‚’å°å…¥
4. **å®‰å…¨æ€§**: ç«¶åˆçŠ¶æ…‹ã®é˜²æ­¢ã‚„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒé©åˆ‡
5. **ä¿å®ˆæ€§**: æ­£è¦æ‰‹é †ã®æ–‡æ›¸åŒ–ã«ã‚ˆã‚Šä»Šå¾Œã®é–‹ç™ºãŒå®‰å…¨

### ğŸ“Š ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹çŠ¶æ³

- âœ… State ManagerçµŒç”±ã®çŠ¶æ…‹æ›´æ–°: 95%ä»¥ä¸Š
- âœ… ãƒ—ãƒ­ã‚­ã‚·ã‚·ã‚¹ãƒ†ãƒ æ´»ç”¨: 100%
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…: 90%ä»¥ä¸Š
- âœ… æ­£è¦æ‰‹é †éµå®ˆ: 95%ä»¥ä¸Š

ç¾åœ¨ã®å®Ÿè£…ã¯ã€è¤‡é›‘åŒ–ã—ãŸãƒãƒˆãƒ«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã«ãŠã„ã¦ã€é©åˆ‡ãªçŠ¶æ…‹ç®¡ç†ã‚’å®Ÿç¾ã§ãã¦ãŠã‚Šã€Copilotã«ã‚ˆã‚‹ä»Šå¾Œã®é–‹ç™ºæ”¯æ´ã§ã‚‚å®‰å…¨ã«ä½œæ¥­ã§ãã‚‹åŸºç›¤ãŒæ•´ã£ã¦ã„ã¾ã™ã€‚

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è£…å‚™ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆ</title>
    <link rel="stylesheet" href="css/card_list.css">
    <link rel="stylesheet" href="css/card-interaction.css">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        .card-area {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .holomem-card {
            width: 150px;
            height: 210px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid #333;
            border-radius: 8px;
            position: relative;
            color: white;
            padding: 10px;
            box-sizing: border-box;
        }
        .support-card {
            width: 120px;
            height: 170px;
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            border: 2px solid #333;
            border-radius: 8px;
            color: white;
            padding: 10px;
            box-sizing: border-box;
            cursor: pointer;
        }
        .support-card.fan {
            background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
        }
        .support-card.tool {
            background: linear-gradient(135deg, #4ecdc4, #44b3a8);
        }
        .support-card.mascot {
            background: linear-gradient(135deg, #45b7d1, #3a9bc1);
        }
        .card-name {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .test-button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #45a049;
        }
        .test-log {
            background: #f8f8f8;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>è£…å‚™ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="test-section">
            <h2>ãƒ†ã‚¹ãƒˆç”¨ãƒ›ãƒ­ãƒ¡ãƒ³ã‚«ãƒ¼ãƒ‰</h2>
            <div class="card-area">
                <div class="holomem-card" id="test-holomem-1">
                    <div class="card-name">ãƒ†ã‚¹ãƒˆãƒ›ãƒ­ãƒ¡ãƒ³1</div>
                    <div>HP: 100</div>
                    <div>è£…å‚™æ•°: <span id="equipment-count-1">0</span></div>
                </div>
                <div class="holomem-card" id="test-holomem-2">
                    <div class="card-name">é›ªèŠ±ãƒ©ãƒŸã‚£</div>
                    <div>HP: 120</div>
                    <div>è£…å‚™æ•°: <span id="equipment-count-2">0</span></div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ãƒ†ã‚¹ãƒˆç”¨ã‚µãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰</h2>
            <div class="card-area">
                <div class="support-card fan" onclick="equipCard('fan1')">
                    <div class="card-name">ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ³</div>
                    <div>ãƒ•ã‚¡ãƒ³ã‚«ãƒ¼ãƒ‰</div>
                </div>
                <div class="support-card tool" onclick="equipCard('tool1')">
                    <div class="card-name">ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«</div>
                    <div>ãƒ„ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰</div>
                </div>
                <div class="support-card mascot" onclick="equipCard('mascot1')">
                    <div class="card-name">ãƒ†ã‚¹ãƒˆãƒã‚¹ã‚³ãƒƒãƒˆ</div>
                    <div>ãƒã‚¹ã‚³ãƒƒãƒˆã‚«ãƒ¼ãƒ‰</div>
                </div>
                <div class="support-card fan" onclick="equipCard('yukimin')">
                    <div class="card-name">é›ªæ°‘</div>
                    <div>ç‰¹æ®Šãƒ•ã‚¡ãƒ³</div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ãƒ†ã‚¹ãƒˆæ“ä½œ</h2>
            <button class="test-button" onclick="clearAllEquipment()">å…¨è£…å‚™ã‚¯ãƒªã‚¢</button>
            <button class="test-button" onclick="testMultipleEquipment()">è¤‡æ•°è£…å‚™ãƒ†ã‚¹ãƒˆ</button>
            <button class="test-button" onclick="testEquipmentLimits()">è£…å‚™åˆ¶é™ãƒ†ã‚¹ãƒˆ</button>
            
            <div class="test-log" id="test-log"></div>
        </div>
    </div>

    <script src="battle_simulator/card-effects/card-effect-utils.js"></script>
    <script src="battle_simulator/card-display-manager.js"></script>
    
    <script>
        // ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿
        const testHolomens = {
            'test-holomem-1': {
                name: 'ãƒ†ã‚¹ãƒˆãƒ›ãƒ­ãƒ¡ãƒ³1',
                id: 'test-001',
                hp: 100,
                equipment: { fans: [], tools: [], mascots: [] }
            },
            'test-holomem-2': {
                name: 'é›ªèŠ±ãƒ©ãƒŸã‚£',
                id: 'test-002',
                hp: 120,
                equipment: { fans: [], tools: [], mascots: [] }
            }
        };

        const testSupportCards = {
            'fan1': {
                name: 'ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ³',
                id: 'fan-001',
                card_type: 'ã‚µãƒãƒ¼ãƒˆãƒ»ãƒ•ã‚¡ãƒ³'
            },
            'tool1': {
                name: 'ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«',
                id: 'tool-001',
                card_type: 'ã‚µãƒãƒ¼ãƒˆãƒ»ãƒ„ãƒ¼ãƒ«'
            },
            'mascot1': {
                name: 'ãƒ†ã‚¹ãƒˆãƒã‚¹ã‚³ãƒƒãƒˆ',
                id: 'mascot-001',
                card_type: 'ã‚µãƒãƒ¼ãƒˆãƒ»ãƒã‚¹ã‚³ãƒƒãƒˆ'
            },
            'yukimin': {
                name: 'é›ªæ°‘',
                id: 'yukimin-001',
                card_type: 'ã‚µãƒãƒ¼ãƒˆãƒ»ãƒ•ã‚¡ãƒ³'
            }
        };

        // ãƒ€ãƒŸãƒ¼BattleEngine
        const mockBattleEngine = {
            players: [null, { hand: [] }, { hand: [] }]
        };

        // CardDisplayManagerã‚’åˆæœŸåŒ–
        const cardDisplayManager = new CardDisplayManager(mockBattleEngine);

        // ãƒ­ã‚°å‡ºåŠ›é–¢æ•°
        function log(message) {
            const logElement = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}<br>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        // è£…å‚™æ•°æ›´æ–°
        function updateEquipmentCount(holomenId) {
            const holomem = testHolomens[holomenId];
            const allEquipment = [
                ...(holomem.equipment.fans || []),
                ...(holomem.equipment.tools || []),
                ...(holomem.equipment.mascots || [])
            ];
            
            const countElement = document.getElementById(`equipment-count-${holomenId.split('-')[2]}`);
            if (countElement) {
                countElement.textContent = allEquipment.length;
            }
        }

        // è£…å‚™å®Ÿè¡Œ
        function equipCard(supportCardId) {
            const supportCard = testSupportCards[supportCardId];
            if (!supportCard) {
                log(`âŒ ã‚µãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${supportCardId}`);
                return;
            }

            log(`ğŸ¯ è£…å‚™é–‹å§‹: ${supportCard.name}`);

            // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¸æŠãƒ¢ãƒ¼ãƒ‰
            const holomemCards = document.querySelectorAll('.holomem-card');
            holomemCards.forEach(card => {
                card.style.border = '3px solid #ffcc02';
                card.style.cursor = 'pointer';
                
                // ä¸€æ™‚çš„ãªã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
                const clickHandler = () => {
                    // ä»–ã®ã‚«ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
                    holomemCards.forEach(c => {
                        c.style.border = '2px solid #333';
                        c.style.cursor = 'default';
                        c.removeEventListener('click', clickHandler);
                    });
                    
                    // è£…å‚™å®Ÿè¡Œ
                    const holomenId = card.id;
                    const targetHolomem = testHolomens[holomenId];
                    
                    if (!targetHolomem) {
                        log(`âŒ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ›ãƒ­ãƒ¡ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${holomenId}`);
                        return;
                    }
                    
                    executeEquipment(targetHolomem, supportCard, card);
                };
                
                card.addEventListener('click', clickHandler);
            });
            
            log('ğŸ‘† è£…å‚™å¯¾è±¡ã®ãƒ›ãƒ­ãƒ¡ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„');
        }

        // è£…å‚™å®Ÿè¡Œ
        function executeEquipment(targetHolomem, supportCard, holomenElement) {
            const utils = new CardEffectUtils(mockBattleEngine);
            const result = utils.attachSupportCard(1, targetHolomem, supportCard);
            
            if (result.success) {
                log(`âœ… è£…å‚™æˆåŠŸ: ${supportCard.name} â†’ ${targetHolomem.name}`);
                
                // è£…å‚™è¡¨ç¤ºã‚’æ›´æ–°
                cardDisplayManager.addEquippedCardsDisplay(holomenElement, targetHolomem);
                
                // è£…å‚™æ•°ã‚’æ›´æ–°
                updateEquipmentCount(holomenElement.id);
                
            } else {
                log(`âŒ è£…å‚™å¤±æ•—: ${result.reason}`);
            }
        }

        // å…¨è£…å‚™ã‚¯ãƒªã‚¢
        function clearAllEquipment() {
            Object.keys(testHolomens).forEach(holomenId => {
                const holomem = testHolomens[holomenId];
                holomem.equipment = { fans: [], tools: [], mascots: [] };
                
                const holomenElement = document.getElementById(holomenId);
                if (holomenElement) {
                    cardDisplayManager.addEquippedCardsDisplay(holomenElement, holomem);
                    updateEquipmentCount(holomenId);
                }
            });
            
            log('ğŸ§¹ å…¨è£…å‚™ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
        }

        // è¤‡æ•°è£…å‚™ãƒ†ã‚¹ãƒˆ
        function testMultipleEquipment() {
            const targetHolomem = testHolomens['test-holomem-1'];
            const holomenElement = document.getElementById('test-holomem-1');
            
            // è¤‡æ•°è£…å‚™ã‚’è¿½åŠ 
            const utils = new CardEffectUtils(mockBattleEngine);
            
            const cards = [
                testSupportCards.fan1,
                testSupportCards.tool1,
                testSupportCards.mascot1
            ];
            
            cards.forEach(card => {
                const result = utils.attachSupportCard(1, targetHolomem, card);
                if (result.success) {
                    log(`âœ… è¤‡æ•°è£…å‚™: ${card.name}`);
                } else {
                    log(`âŒ è¤‡æ•°è£…å‚™å¤±æ•—: ${result.reason}`);
                }
            });
            
            // è¡¨ç¤ºæ›´æ–°
            cardDisplayManager.addEquippedCardsDisplay(holomenElement, targetHolomem);
            updateEquipmentCount('test-holomem-1');
        }

        // è£…å‚™åˆ¶é™ãƒ†ã‚¹ãƒˆ
        function testEquipmentLimits() {
            const targetHolomem = testHolomens['test-holomem-1'];
            const utils = new CardEffectUtils(mockBattleEngine);
            
            // åŒã˜ã‚¿ã‚¤ãƒ—ã®ã‚«ãƒ¼ãƒ‰ã‚’è¤‡æ•°è£…å‚™ã—ã¦ã¿ã‚‹
            const fanCard1 = { ...testSupportCards.fan1, id: 'fan-002', name: 'ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ³2' };
            const fanCard2 = { ...testSupportCards.fan1, id: 'fan-003', name: 'ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ³3' };
            
            const result1 = utils.attachSupportCard(1, targetHolomem, testSupportCards.fan1);
            const result2 = utils.attachSupportCard(1, targetHolomem, fanCard1);
            
            log(`ğŸ§ª åˆ¶é™ãƒ†ã‚¹ãƒˆ1: ${result1.success ? 'æˆåŠŸ' : result1.reason}`);
            log(`ğŸ§ª åˆ¶é™ãƒ†ã‚¹ãƒˆ2: ${result2.success ? 'æˆåŠŸ' : result2.reason}`);
            
            // é›ªæ°‘ã®ç‰¹æ®Šåˆ¶é™ãƒ†ã‚¹ãƒˆ
            const lamiTarget = testHolomens['test-holomem-2'];
            const yukiminResult = utils.attachSupportCard(1, lamiTarget, testSupportCards.yukimin);
            log(`â„ï¸ é›ªæ°‘ãƒ†ã‚¹ãƒˆ: ${yukiminResult.success ? 'æˆåŠŸ' : yukiminResult.reason}`);
            
            // è¡¨ç¤ºæ›´æ–°
            const holomenElement1 = document.getElementById('test-holomem-1');
            const holomenElement2 = document.getElementById('test-holomem-2');
            
            cardDisplayManager.addEquippedCardsDisplay(holomenElement1, targetHolomem);
            cardDisplayManager.addEquippedCardsDisplay(holomenElement2, lamiTarget);
            
            updateEquipmentCount('test-holomem-1');
            updateEquipmentCount('test-holomem-2');
        }

        // åˆæœŸåŒ–
        log('è£…å‚™ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
        log('ã‚µãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è£…å‚™ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„');
    </script>
</body>
</html>

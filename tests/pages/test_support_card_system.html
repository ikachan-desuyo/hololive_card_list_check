<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚µãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ  ãƒ†ã‚¹ãƒˆ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f0f0f0;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .test-section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .card-example {
      background: #f9f9f9;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      border-left: 4px solid #007bff;
    }
    .success {
      border-left-color: #28a745;
      background-color: #d4edda;
    }
    .error {
      border-left-color: #dc3545;
      background-color: #f8d7da;
    }
    .warning {
      border-left-color: #ffc107;
      background-color: #fff3cd;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #007bff;
      color: white;
    }
    button:hover {
      background-color: #0056b3;
    }
    .log-area {
      background: #000;
      color: #00ff00;
      padding: 15px;
      border-radius: 5px;
      font-family: monospace;
      height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ´ ã‚µãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ å‹•ä½œãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
      <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆæ¦‚è¦</h2>
      <p>ã“ã®ãƒšãƒ¼ã‚¸ã¯ã€ãƒ›ãƒ­ãƒ©ã‚¤ãƒ–TCGãƒãƒˆãƒ«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ã‚µãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰ï¼ˆãƒ•ã‚¡ãƒ³ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒã‚¹ã‚³ãƒƒãƒˆï¼‰è£…å‚™ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
    </div>

    <div class="test-section">
      <h2>ğŸ”§ ãƒ†ã‚¹ãƒˆé …ç›®</h2>
      <button onclick="testCardEffectUtils()">CardEffectUtilsèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</button>
      <button onclick="testAttachSupportCard()">ã‚µãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰è£…å‚™ãƒ†ã‚¹ãƒˆ</button>
      <button onclick="testEquipmentRules()">è£…å‚™ãƒ«ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ</button>
      <button onclick="testSpecialCards()">ç‰¹æ®Šã‚«ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆï¼ˆé›ªæ°‘ãƒ»ã“ã‚ˆã‚Šã®åŠ©æ‰‹ãã‚“ï¼‰</button>
      <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
    </div>

    <div class="test-section">
      <h2>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœ</h2>
      <div id="logArea" class="log-area">
ãƒ†ã‚¹ãƒˆé–‹å§‹æº–å‚™å®Œäº†...
ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚
      </div>
    </div>

    <div class="test-section">
      <h2>ğŸ“ å®Ÿè£…çŠ¶æ³</h2>
      <div class="card-example warning">
        <strong>âš ï¸ ç¾åœ¨ã®å•é¡Œ:</strong><br>
        â€¢ HandManagerã®useSupportCardãƒ¡ã‚½ãƒƒãƒ‰ã§TODOã‚³ãƒ¡ãƒ³ãƒˆã®ã¿<br>
        â€¢ å®Ÿéš›ã®è£…å‚™å‡¦ç†ãŒå‘¼ã³å‡ºã•ã‚Œã¦ã„ãªã„<br>
        â€¢ UIã§ã®è£…å‚™è¡¨ç¤ºãŒæœªå®Ÿè£…
      </div>
      <div class="card-example success">
        <strong>âœ… å®Ÿè£…æ¸ˆã¿:</strong><br>
        â€¢ CardEffectUtilsã«attachSupportCardãƒ¡ã‚½ãƒƒãƒ‰<br>
        â€¢ ãƒ•ã‚¡ãƒ³ãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒã‚¹ã‚³ãƒƒãƒˆã®è£…å‚™åˆ¶é™ãƒ­ã‚¸ãƒƒã‚¯<br>
        â€¢ ç‰¹æ®Šã‚«ãƒ¼ãƒ‰ï¼ˆé›ªæ°‘ã€ã“ã‚ˆã‚Šã®åŠ©æ‰‹ãã‚“ï¼‰ã®åˆ¶é™
      </div>
    </div>
  </div>

  <!-- å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ -->
  <script src="js/utils.js"></script>
  <script src="battle_simulator/card-effects/card-effect-utils.js"></script>

  <script>
    // ãƒ­ã‚°å‡ºåŠ›é–¢æ•°
    function log(message, type = 'info') {
      const logArea = document.getElementById('logArea');
      const timestamp = new Date().toLocaleTimeString();
      const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
      
      logArea.textContent += `[${timestamp}] ${prefix} ${message}\n`;
      logArea.scrollTop = logArea.scrollHeight;
    }

    function clearLog() {
      document.getElementById('logArea').textContent = 'ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ...\n';
    }

    // ãƒ¢ãƒƒã‚¯BattleEngineã‚¯ãƒ©ã‚¹ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
    class MockBattleEngine {
      constructor() {
        this.players = {
          1: {
            hand: [],
            center: null,
            collab: null,
            back1: null,
            back2: null,
            back3: null,
            back4: null,
            back5: null
          }
        };
      }
    }

    // ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿
    const mockCards = {
      fan: {
        id: 'test-fan-001',
        name: 'ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ³',
        card_type: 'ã‚µãƒãƒ¼ãƒˆãƒ»ãƒ•ã‚¡ãƒ³',
        image_url: 'test.jpg'
      },
      tool: {
        id: 'test-tool-001', 
        name: 'ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«',
        card_type: 'ã‚µãƒãƒ¼ãƒˆãƒ»ãƒ„ãƒ¼ãƒ«',
        image_url: 'test.jpg'
      },
      mascot: {
        id: 'test-mascot-001',
        name: 'ãƒ†ã‚¹ãƒˆãƒã‚¹ã‚³ãƒƒãƒˆ', 
        card_type: 'ã‚µãƒãƒ¼ãƒˆãƒ»ãƒã‚¹ã‚³ãƒƒãƒˆ',
        image_url: 'test.jpg'
      },
      yukimin: {
        id: 'hBP04-106',
        name: 'é›ªæ°‘',
        card_type: 'ã‚µãƒãƒ¼ãƒˆãƒ»ãƒ•ã‚¡ãƒ³',
        image_url: 'test.jpg'
      },
      koyori_assistant: {
        id: 'hBP04-105',
        name: 'ã“ã‚ˆã‚Šã®åŠ©æ‰‹ãã‚“',
        card_type: 'ã‚µãƒãƒ¼ãƒˆãƒ»ãƒ•ã‚¡ãƒ³',
        image_url: 'test.jpg'
      },
      holomem_lamy: {
        id: 'test-lamy',
        name: 'é›ªèŠ±ãƒ©ãƒŸã‚£',
        card_type: 'ãƒ›ãƒ­ãƒ¡ãƒ³',
        image_url: 'test.jpg',
        equipment: { fans: [], mascots: [], tools: [] }
      },
      holomem_koyori: {
        id: 'test-koyori',
        name: 'åšè¡£ã“ã‚ˆã‚Š',
        card_type: 'ãƒ›ãƒ­ãƒ¡ãƒ³', 
        image_url: 'test.jpg',
        equipment: { fans: [], mascots: [], tools: [] }
      },
      holomem_other: {
        id: 'test-other',
        name: 'ãƒ†ã‚¹ãƒˆãƒ›ãƒ­ãƒ¡ãƒ³',
        card_type: 'ãƒ›ãƒ­ãƒ¡ãƒ³',
        image_url: 'test.jpg',
        equipment: { fans: [], mascots: [], tools: [] }
      }
    };

    // CardEffectUtilsèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
    function testCardEffectUtils() {
      log('=== CardEffectUtilsèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
      
      try {
        if (typeof CardEffectUtils === 'undefined') {
          log('CardEffectUtilsã‚¯ãƒ©ã‚¹ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
          return;
        }
        
        const mockEngine = new MockBattleEngine();
        const utils = new CardEffectUtils(mockEngine);
        
        if (typeof utils.attachSupportCard === 'function') {
          log('CardEffectUtilsæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'success');
          log('attachSupportCardãƒ¡ã‚½ãƒƒãƒ‰ãŒåˆ©ç”¨å¯èƒ½ã§ã™', 'success');
        } else {
          log('attachSupportCardãƒ¡ã‚½ãƒƒãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
        }
      } catch (error) {
        log(`CardEffectUtilsåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
      }
    }

    // ã‚µãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰è£…å‚™ãƒ†ã‚¹ãƒˆ
    function testAttachSupportCard() {
      log('=== ã‚µãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰è£…å‚™ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
      
      try {
        const mockEngine = new MockBattleEngine();
        const utils = new CardEffectUtils(mockEngine);
        
        // ãƒ•ã‚¡ãƒ³ã‚«ãƒ¼ãƒ‰è£…å‚™ãƒ†ã‚¹ãƒˆ
        log('ãƒ•ã‚¡ãƒ³ã‚«ãƒ¼ãƒ‰è£…å‚™ãƒ†ã‚¹ãƒˆ...');
        const fanResult = utils.attachSupportCard(1, mockCards.holomem_other, mockCards.fan);
        log(`ãƒ•ã‚¡ãƒ³è£…å‚™çµæœ: ${fanResult.success ? 'SUCCESS' : 'FAILED - ' + fanResult.reason}`, 
            fanResult.success ? 'success' : 'error');
        
        // ãƒ„ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰è£…å‚™ãƒ†ã‚¹ãƒˆ
        log('ãƒ„ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰è£…å‚™ãƒ†ã‚¹ãƒˆ...');
        const toolResult = utils.attachSupportCard(1, mockCards.holomem_other, mockCards.tool);
        log(`ãƒ„ãƒ¼ãƒ«è£…å‚™çµæœ: ${toolResult.success ? 'SUCCESS' : 'FAILED - ' + toolResult.reason}`, 
            toolResult.success ? 'success' : 'error');
        
        // ãƒã‚¹ã‚³ãƒƒãƒˆã‚«ãƒ¼ãƒ‰è£…å‚™ãƒ†ã‚¹ãƒˆ
        log('ãƒã‚¹ã‚³ãƒƒãƒˆã‚«ãƒ¼ãƒ‰è£…å‚™ãƒ†ã‚¹ãƒˆ...');
        const mascotResult = utils.attachSupportCard(1, mockCards.holomem_other, mockCards.mascot);
        log(`ãƒã‚¹ã‚³ãƒƒãƒˆè£…å‚™çµæœ: ${mascotResult.success ? 'SUCCESS' : 'FAILED - ' + mascotResult.reason}`, 
            mascotResult.success ? 'success' : 'error');
        
      } catch (error) {
        log(`è£…å‚™ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
      }
    }

    // è£…å‚™ãƒ«ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆï¼ˆåˆ¶é™ãƒã‚§ãƒƒã‚¯ï¼‰
    function testEquipmentRules() {
      log('=== è£…å‚™ãƒ«ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
      
      try {
        const mockEngine = new MockBattleEngine();
        const utils = new CardEffectUtils(mockEngine);
        const testHolomem = JSON.parse(JSON.stringify(mockCards.holomem_other));
        
        // 1. ãƒ„ãƒ¼ãƒ«é‡è¤‡è£…å‚™ãƒ†ã‚¹ãƒˆ
        log('ãƒ„ãƒ¼ãƒ«é‡è¤‡è£…å‚™åˆ¶é™ãƒ†ã‚¹ãƒˆ...');
        const tool1Result = utils.attachSupportCard(1, testHolomem, mockCards.tool);
        log(`1å›ç›®ã®ãƒ„ãƒ¼ãƒ«è£…å‚™: ${tool1Result.success ? 'SUCCESS' : 'FAILED'}`, 
            tool1Result.success ? 'success' : 'error');
        
        const tool2Result = utils.attachSupportCard(1, testHolomem, {
          ...mockCards.tool,
          id: 'test-tool-002',
          name: 'ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«2'
        });
        log(`2å›ç›®ã®ãƒ„ãƒ¼ãƒ«è£…å‚™: ${tool2Result.success ? 'FAILED (æ­£å¸¸)' : 'SUCCESS (ç•°å¸¸)'}`, 
            !tool2Result.success ? 'success' : 'error');
        log(`åˆ¶é™ç†ç”±: ${tool2Result.reason || 'ãªã—'}`);
        
        // 2. ãƒã‚¹ã‚³ãƒƒãƒˆé‡è¤‡è£…å‚™ãƒ†ã‚¹ãƒˆ
        log('ãƒã‚¹ã‚³ãƒƒãƒˆé‡è¤‡è£…å‚™åˆ¶é™ãƒ†ã‚¹ãƒˆ...');
        const testHolomem2 = JSON.parse(JSON.stringify(mockCards.holomem_other));
        const mascot1Result = utils.attachSupportCard(1, testHolomem2, mockCards.mascot);
        const mascot2Result = utils.attachSupportCard(1, testHolomem2, {
          ...mockCards.mascot,
          id: 'test-mascot-002',
          name: 'ãƒ†ã‚¹ãƒˆãƒã‚¹ã‚³ãƒƒãƒˆ2'
        });
        log(`ãƒã‚¹ã‚³ãƒƒãƒˆé‡è¤‡è£…å‚™ã¯åˆ¶é™ã•ã‚Œã¾ã—ãŸ: ${!mascot2Result.success ? 'OK' : 'NG'}`, 
            !mascot2Result.success ? 'success' : 'error');
        
      } catch (error) {
        log(`è£…å‚™ãƒ«ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
      }
    }

    // ç‰¹æ®Šã‚«ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ
    function testSpecialCards() {
      log('=== ç‰¹æ®Šã‚«ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
      
      try {
        const mockEngine = new MockBattleEngine();
        const utils = new CardEffectUtils(mockEngine);
        
        // é›ªæ°‘ãƒ†ã‚¹ãƒˆ
        log('é›ªæ°‘è£…å‚™ãƒ†ã‚¹ãƒˆ...');
        
        // é›ªèŠ±ãƒ©ãƒŸã‚£ã«è£…å‚™ï¼ˆæˆåŠŸã™ã‚‹ã¹ãï¼‰
        const lamyResult = utils.attachSupportCard(1, mockCards.holomem_lamy, mockCards.yukimin);
        log(`é›ªæ°‘ â†’ é›ªèŠ±ãƒ©ãƒŸã‚£: ${lamyResult.success ? 'SUCCESS' : 'FAILED - ' + lamyResult.reason}`, 
            lamyResult.success ? 'success' : 'error');
        
        // ä»–ã®ãƒ›ãƒ­ãƒ¡ãƒ³ã«è£…å‚™ï¼ˆå¤±æ•—ã™ã‚‹ã¹ãï¼‰
        const otherResult = utils.attachSupportCard(1, mockCards.holomem_other, mockCards.yukimin);
        log(`é›ªæ°‘ â†’ ä»–ãƒ›ãƒ­ãƒ¡ãƒ³: ${!otherResult.success ? 'REJECTED (æ­£å¸¸)' : 'ACCEPTED (ç•°å¸¸)'}`, 
            !otherResult.success ? 'success' : 'error');
        log(`åˆ¶é™ç†ç”±: ${otherResult.reason || 'ãªã—'}`);
        
        // ã“ã‚ˆã‚Šã®åŠ©æ‰‹ãã‚“ãƒ†ã‚¹ãƒˆ
        log('ã“ã‚ˆã‚Šã®åŠ©æ‰‹ãã‚“è£…å‚™ãƒ†ã‚¹ãƒˆ...');
        
        // åšè¡£ã“ã‚ˆã‚Šã«è£…å‚™ï¼ˆæˆåŠŸã™ã‚‹ã¹ãï¼‰
        const koyoriResult = utils.attachSupportCard(1, mockCards.holomem_koyori, mockCards.koyori_assistant);
        log(`ã“ã‚ˆã‚Šã®åŠ©æ‰‹ãã‚“ â†’ åšè¡£ã“ã‚ˆã‚Š: ${koyoriResult.success ? 'SUCCESS' : 'FAILED - ' + koyoriResult.reason}`, 
            koyoriResult.success ? 'success' : 'error');
        
      } catch (error) {
        log(`ç‰¹æ®Šã‚«ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
      }
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
    window.addEventListener('load', function() {
      log('ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
      log('åˆ©ç”¨å¯èƒ½ãªãƒ†ã‚¹ãƒˆé …ç›®:');
      log('â€¢ CardEffectUtilsèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ');
      log('â€¢ ã‚µãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰è£…å‚™ãƒ†ã‚¹ãƒˆ'); 
      log('â€¢ è£…å‚™ãƒ«ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ');
      log('â€¢ ç‰¹æ®Šã‚«ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ');
      log('');
      log('ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚');
    });
  </script>
</body>
</html>
